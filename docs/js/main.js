var Utils=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,n){var i=n(5),r=n(6),o=n(7),a=n(8),s=n(9),l=n(10),c=n(11);c.alea=i,c.xor128=r,c.xorwow=o,c.xorshift7=a,c.xor4096=s,c.tychei=l,t.exports=c},function(t,e){AFRAME.registerComponent("beam",{schema:{length:{type:"number"},width:{type:"number"},thickness:{type:"number"},height:{type:"number"},src:{type:"map",default:"#ceilingTexture"}},init:function(){let t=this.data,e=this.el,n=(new THREE.TextureLoader).load(t.src.src),i=new THREE.BoxBufferGeometry(t.length,t.thickness,t.width),r=new THREE.Mesh(i,new THREE.MeshBasicMaterial({map:n}));e.setObject3D("mesh",r),r.position.set(t.length/2,t.height,0)},update:function(){},remove:function(){},tick:function(t,e){}}),AFRAME.registerComponent("wall",{schema:{length:{type:"number"},height:{type:"number",default:5},orientation:{type:"string",default:"left"},color:{type:"string",default:"#ffffff"},artifacts:{default:"[]",parse:JSON.parse,stringify:JSON.stringify},src:{type:"map",default:"#wallTexture"}},init:function(){let t=this.data,e=this.el;this._rig=document.getElementById("rig"),this.distVector=new THREE.Vector3,this.artPlaced=!1;let n=(new THREE.TextureLoader).load(t.src.src),i=new THREE.PlaneBufferGeometry(t.length,t.height),r=new THREE.MeshBasicMaterial({map:n}),o=new THREE.Mesh(i,r);e.setObject3D("mesh",o);let a=document.createElement("a-entity");a.setAttribute("beam",`length: ${t.length+.2}; width: 0.3; thickness: 0.5; height: ${t.height-.25}`),e.appendChild(a),o.position.set(t.length/2,t.height/2,0),"right"==t.orientation&&o.rotateY(3.14159),this.placeArt()},update:function(){},remove:function(){},tick:function(t,e){},placeArt:function(){let t=this.data.artifacts,e=t.length+1,n=this.data.length/e;for(let e=1;e<=t.length;e++){let i=t[e-1],r=document.createElement("a-entity");r.setAttribute("wall-art",{artifact:JSON.stringify(i),width:n}),this.el.appendChild(r),r.setAttribute("position",{x:n*e,y:1.52,z:.2}),"right"==this.data.orientation?(r.setAttribute("position",{x:n*e,y:1.52,z:-.2}),r.setAttribute("rotation",{x:0,y:180,z:0}),AFRAME.utils.device.isMobile()&&this.el.appendChild(this.initCheckPoint({x:n*e,y:.1,z:-2}))):AFRAME.utils.device.isMobile()&&this.el.appendChild(this.initCheckPoint({x:n*e,y:.1,z:2}))}},initCheckPoint:function(t){let e=document.createElement("a-plane");return e.setAttribute("checkpoint",""),e.setAttribute("class","clickable"),e.setAttribute("geometry","primitive: ring; radiusInner: 0.6; radiusOuter: .8;"),e.setAttribute("material","color: #CCC; shader: flat;"),e.setAttribute("position",t),e.setAttribute("rotation",{x:-90,y:0,z:0}),e}}),AFRAME.registerComponent("floor",{schema:{width:{type:"number"},depth:{type:"number"},src:{type:"map",default:"#floorTexture"}},init:function(){let t=this.data,e=this.el,n=(new THREE.TextureLoader).load(t.src.src),i=new THREE.BoxBufferGeometry(t.depth,.01,t.width),r=new THREE.Mesh(i,new THREE.MeshBasicMaterial({map:n}));e.setObject3D("mesh",r),r.position.set(t.depth/2,0,-t.width/2)},update:function(){},remove:function(){},tick:function(t,e){}}),AFRAME.registerComponent("ceiling",{schema:{width:{type:"number"},height:{type:"number",default:5},rotateY:{type:"number"},roomLength:{type:"number"},src:{type:"map",default:"#ceilingTexture"}},init:function(){let t=this.data,e=this.el;for(let n=0;n<t.roomLength;n+=8){let i=document.createElement("a-entity");i.setAttribute("beam",{length:t.width,width:.3,thickness:.5,height:t.height-.25}),i.setAttribute("position",{x:n,y:0,z:0}),i.setAttribute("rotation",{x:0,y:t.rotateY,z:0}),e.appendChild(i)}},update:function(){},remove:function(){},tick:function(t,e){}}),AFRAME.registerComponent("rectframe",{schema:{height:{type:"number"},width:{type:"number"},src:{type:"map",default:"#floorTexture"}},init:function(){let t=this.el.object3D,e=this.data,n=(new THREE.TextureLoader).load(e.src.src),i=new THREE.BoxBufferGeometry(.04,e.width,.04),r=new THREE.BoxBufferGeometry(.04,e.height,.04),o=new THREE.Mesh(r,new THREE.MeshStandardMaterial({map:n})),a=new THREE.Mesh(r,new THREE.MeshStandardMaterial({map:n})),s=new THREE.Mesh(i,new THREE.MeshStandardMaterial({map:n})),l=new THREE.Mesh(i,new THREE.MeshStandardMaterial({map:n}));o.position.set(i.parameters.height/2-.02,0,0),a.position.set(-i.parameters.height/2+.02,0,0),s.position.set(0,r.parameters.height/2-.02,0),l.position.set(0,-r.parameters.height/2+.02,0),s.rotation.set(0,0,Math.PI/2),l.rotation.set(0,0,Math.PI/2),t.add(o),t.add(a),t.add(s),t.add(l)}}),AFRAME.registerComponent("wall-art",{schema:{artifact:{default:"{}",parse:JSON.parse,stringify:JSON.stringify},width:{type:"number"}},init:function(){let t=this.data,e=this.el,n=document.createElement("div"),i=document.createElement("pre"),r=document.createElement("code");e.className="frame",e.setAttribute("htmlembed","");switch(t.artifact.type){case"image":e.setAttribute("id",t.artifact.alt),n.className="vr-img",e.className="img-frame";let o=document.createElement("img");o.setAttribute("src",t.artifact.src),n.appendChild(o);break;case"block quote":n.className="vr-col-6",e.classList.add("block-quote"),n.innerHTML+=t.artifact.text;break;case"word art":e.classList.add("word-art"),n.className="vr-col-6",n.innerHTML+=t.artifact.html;break;case"code":n.className="code",r.innerHTML+=t.artifact.code,i.appendChild(r),n.appendChild(i),hljs.highlightBlock(r);break;case"code block":n.className="code",r.className="language-"+t.artifact.lang,r.innerHTML+=t.artifact.code,i.appendChild(r),n.appendChild(i),hljs.highlightBlock(r)}null!=t.artifact.audioSrc&&(e.classList.add("clickable"),e.setAttribute("sound",{src:`url(${t.artifact.audioSrc})`,on:"click",maxDistance:2,autoplay:!1})),e.appendChild(n),this.htmlembed=e.components.htmlembed,this.frame=!1},update:function(){},remove:function(){},tick:function(t,e){this.el.classList.contains("word-art")&&(this.frame=!0),!this.frame&&this.htmlembed.width>0&&(this.el.setAttribute("rectframe",{height:this.htmlembed.height,width:this.htmlembed.width}),this.frame=!0)}}),AFRAME.registerComponent("play-audio",{schema:{distance:{type:"number"}},init:function(){},update:function(){},remove:function(){},tick:function(t,e){}}),AFRAME.registerComponent("malloci",{schema:{tree:{default:"{}",parse:JSON.parse,stringify:JSON.stringify},API:{type:"string",default:""},hallWidth:{type:"number",default:8},wallHeight:{type:"number",default:5}},init:function(){let t=this.data;this._roomWidth=t.hallWidth,this._rig=document.getElementById("rig"),this._camera=document.getElementById("camera"),this._tree=t.tree,""!=t.API?this.GenerateArtifacts():this.build()},update:function(t){let e=this.data;if(0!==Object.keys(t).length&&e.tree!=t.tree){for(;this.el.lastElementChild;)this.el.removeChild(this.el.lastElementChild);this._tree=e.tree,this.build()}},GenerateArtifacts:async function(){const t=await fetch(this.data.API,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(this._tree)});if(!t.ok)throw new Error("Network response was not ok");this._tree=await t.json(),localStorage.setItem(this._tree.name+"_museumTree",JSON.stringify(this._tree)),this.build()},build:function(){null!=this._tree.theme.floor&&document.getElementById("floorTexture").setAttribute("src",this._tree.theme.floor),null!=this._tree.theme.walls&&document.getElementById("wallTexture").setAttribute("src",this._tree.theme.walls),null!=this._tree.theme.ceiling&&document.getElementById("ceilingTexture").setAttribute("src",this._tree.theme.ceiling),this.rng=new Utils.seedrandom(this._tree.name);let t=this._tree.rooms;this.el.appendChild(this.Wall("north",[],this._roomWidth,0,0,0));let e=0,n=this._roomWidth,i=0,r=0,o=270,a=0,s=0;for(let l=1;l<=t.length;l++){let c=t[l-1],u=0;if(null!=c.subrooms&&c.subrooms.length!=[])for(let t=1;t<=c.subrooms.length;t++){u+=3.2*c.subrooms[t-1].artifacts.length}else u=3.2*c.artifacts.length;u<this._roomWidth&&(u+=this._roomWidth);let h="left_"+l,d="right_"+l,f=null,m=null,p=Math.floor(c.artifacts.length/2),g=c.artifacts.slice(0,p),b=c.artifacts.slice(p),x=0,y=0,w=0;if(1==l)this.CreateJumpTo(c.name,this._roomWidth/2,1,180),this.rng()<.5?(a++,x=u+this._roomWidth,y=u,w=y):(s++,x=u,y=u+this._roomWidth,w=x),m=this.Wall(d,b,x,e,i,o,"right"),f=this.Wall(h,g,y,n,r,o),m.appendChild(this.floor("floor"+l,this._roomWidth,w,0,0,0)),f.setAttribute("ceiling",{width:this._roomWidth,roomLength:y,rotateY:-90}),this.el.appendChild(m),this.el.appendChild(f),i+=x,r+=y,a>0?o+=90:o-=90;else if(l!=t.length){this.rng()<.5&&a<2||2==s?(x=a?u+2*this._roomWidth:u,y=u,w=a?u+this._roomWidth:y,a++,s=0):(x=u,y=a>0?u:u+2*this._roomWidth,w=a>0?x:u+this._roomWidth,s++,a=0),m=this.Wall(d,b,x,e,i,o,"right"),f=this.Wall(h,g,y,n,r,o),0==s&&a<2||s>=2?(f.appendChild(this.floor("floor"+l,this._roomWidth,w,0,this._roomWidth,0)),m.setAttribute("ceiling",{width:this._roomWidth,roomLength:w,rotateY:90})):(m.appendChild(this.floor("floor"+l,this._roomWidth,w,0,0,0)),f.setAttribute("ceiling",{width:this._roomWidth,roomLength:w,rotateY:-90})),this.el.appendChild(m),this.el.appendChild(f);let t=(e+n)/2,p=(i+r)/2;switch(o){case 90:case 450:i-=x,r-=y;break;case 180:e-=x,n-=y;break;case 270:i+=x,r+=y;break;case 360:case 0:e+=x,n+=y}this.CreateJumpTo(c.name,t,p,o),a>0?o+=90:o-=90}else{a>0?(x=u+this._roomWidth,y=u):(x=u,y=u+this._roomWidth),w=u+this._roomWidth,m=this.Wall(d,b,x,e,i,o,"right"),f=this.Wall(h,g,y,n,r,o),x>y?f.setAttribute("ceiling",{width:this._roomWidth,roomLength:y,rotateY:-90}):m.setAttribute("ceiling",{width:this._roomWidth,roomLength:x,rotateY:90}),this.el.appendChild(m),this.el.appendChild(f);let t=n,s=r,p=(e+n)/2,A=(i+r)/2;switch(o){case 90:case 450:s=r-y;break;case 180:t=n-y;break;case 270:s=r+y;break;case 360:case 0:t=n+y}let v=this.Wall(h,[],this._roomWidth,t,s,o-90);v.appendChild(this.floor("floor"+l,this._roomWidth,w,0,0,-90)),a>0?o+=90:o-=90,this.CreateJumpTo(c.name,p,A,o),this.el.appendChild(v)}}localStorage.setItem(this._tree.name+"_museumTree",JSON.stringify(this._tree))},Wall:function(t,e,n,i,r,o,a="left"){let s=document.createElement("a-entity");return s.setAttribute("wall",{length:n,orientation:a,artifacts:JSON.stringify(e)}),s.setAttribute("id",t),s.setAttribute("width",n),s.setAttribute("position",{x:i,y:0,z:r}),s.setAttribute("rotation",{x:0,y:o,z:0}),s},floor:function(t,e,n,i,r,o){let a=document.createElement("a-entity");return a.setAttribute("id",t),a.setAttribute("class","scenery"),a.setAttribute("floor",{width:e,depth:n}),a.setAttribute("position",{x:i,y:0,z:r}),a.setAttribute("rotation",{x:0,y:o,z:0}),a},InitCheckPoint:function(t){let e=document.createElement("a-sphere");e.setAttribute("checkpoint",""),e.setAttribute("position",t),e.setAttribute("opacity",0);let n=document.createElement("a-entity");return n.setAttribute("geometry","primitive: ring; radiusInner: 0.6; radiusOuter: .8;"),n.setAttribute("material","color: #CCC; shader: flat;"),n.setAttribute("rotation",{x:-90,y:0,z:0}),e.appendChild(n),e},CreateJumpTo:function(t,e,n,i){console.log(t.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=_`~()?]/g,"").replace(/ /g,"-"));let r=document.getElementById(t.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=_`~()?]/g,"").replace(/ /g,"-"));if(null==r)return;let o=document.createElement("img");o.setAttribute("src","img/logo.svg"),o.setAttribute("class","jump"),o.addEventListener("click",()=>{this._rig.setAttribute("position",{x:e,y:0,z:n}),this._camera.setAttribute("rotation",{x:0,y:i,z:0}),this.el.sceneEl.enterVR()}),r.appendChild(o),this.el.emit("done")}})},function(t,e,n){(function(t){var i;!function(t,r,o){function a(t){var e,n=this,i=(e=4022871197,function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(t),n.s0<0&&(n.s0+=1),n.s1-=i(t),n.s1<0&&(n.s1+=1),n.s2-=i(t),n.s2<0&&(n.s2+=1),i=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function l(t,e){var n=new a(t),i=e&&e.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=l:n(0)&&n(2)?void 0===(i=function(){return l}.call(e,n,e,r))||(r.exports=i):this.alea=l}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function a(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function l(t,e){var n=new a(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=l:n(0)&&n(2)?void 0===(i=function(){return l}.call(e,n,e,r))||(r.exports=i):this.xor128=l}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function a(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),i==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function l(t,e){var n=new a(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=l:n(0)&&n(2)?void 0===(i=function(){return l}.call(e,n,e,r))||(r.exports=i):this.xorwow=l}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function a(t){var e=this;e.next=function(){var t,n,i=e.x,r=e.i;return t=i[r],n=(t^=t>>>7)^t<<24,n^=(t=i[r+1&7])^t>>>10,n^=(t=i[r+3&7])^t>>>3,n^=(t=i[r+4&7])^t<<7,t=i[r+7&7],n^=(t^=t<<13)^t<<9,i[r]=n,e.i=r+1&7,n},function(t,e){var n,i=[];if(e===(0|e))i[0]=e;else for(e=""+e,n=0;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],t.x=i,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function l(t,e){null==t&&(t=+new Date);var n=new a(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.x&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=l:n(0)&&n(2)?void 0===(i=function(){return l}.call(e,n,e,r))||(r.exports=i):this.xorshift7=l}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function a(t){var e=this;e.next=function(){var t,n,i=e.w,r=e.X,o=e.i;return e.w=i=i+1640531527|0,n=r[o+34&127],t=r[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=r[o]=n^t,e.i=o,n+(i^i>>>16)|0},function(t,e){var n,i,r,o,a,s=[],l=128;for(e===(0|e)?(i=e,e=null):(e+="\0",i=0,l=Math.max(l,e.length)),r=0,o=-32;o<l;++o)e&&(i^=e.charCodeAt((o+32)%e.length)),0===o&&(a=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(a=a+1640531527|0,r=0==(n=s[127&o]^=i+a)?r+1:0);for(r>=128&&(s[127&(e&&e.length||0)]=-1),r=127,o=512;o>0;--o)i=s[r+34&127],n=s[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,s[r]=i^n;t.w=a,t.X=s,t.i=r}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function l(t,e){null==t&&(t=+new Date);var n=new a(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.X&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=l:n(0)&&n(2)?void 0===(i=function(){return l}.call(e,n,e,r))||(r.exports=i):this.xor4096=l}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){(function(t){var i;!function(t,r,o){function a(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,i=e.d,r=e.a;return t=t<<25^t>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-i|0,e.d=i<<16^n>>>16^r,e.a=r-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var i=0;i<n.length+20;i++)e.b^=0|n.charCodeAt(i),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function l(t,e){var n=new a(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=l:n(0)&&n(2)?void 0===(i=function(){return l}.call(e,n,e,r))||(r.exports=i):this.tychei=l}(0,t,n(0))}).call(this,n(1)(t))},function(t,e,n){var i;!function(r,o,a){var s,l=a.pow(256,6),c=a.pow(2,52),u=2*c;function h(t,e,n){var i=[],h=m(function t(e,n){var i,r=[],o=typeof e;if(n&&"object"==o)for(i in e)try{r.push(t(e[i],n-1))}catch(t){}return r.length?r:"string"==o?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,p(o)]:null==t?function(){try{var t;return s&&(t=s.randomBytes)?t=t(256):(t=new Uint8Array(256),(r.crypto||r.msCrypto).getRandomValues(t)),p(t)}catch(t){var e=r.navigator,n=e&&e.plugins;return[+new Date,r,n,r.screen,p(o)]}}():t,3),i),g=new d(i),b=function(){for(var t=g.g(6),e=l,n=0;t<c;)t=256*(t+n),e*=256,n=g.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|g.g(4)},b.quick=function(){return g.g(4)/4294967296},b.double=b,m(p(g.S),o),(e.pass||n||function(t,e,n,i){return i&&(i.S&&f(i,g),t.state=function(){return f(g,{})}),n?(a.random=t,e):t})(b,h,"global"in e?e.global:this==a,e.state)}function d(t){var e,n=t.length,i=this,r=0,o=i.i=i.j=0,a=i.S=[];for(n||(t=[n++]);r<256;)a[r]=r++;for(r=0;r<256;r++)a[r]=a[o=255&o+t[r%n]+(e=a[r])],a[o]=e;(i.g=function(t){for(var e,n=0,r=i.i,o=i.j,a=i.S;t--;)e=a[r=255&r+1],n=256*n+a[255&(a[r]=a[o=255&o+e])+(a[o]=e)];return i.i=r,i.j=o,n})(256)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,i=t+"",r=0;r<i.length;)e[255&r]=255&(n^=19*e[255&r])+i.charCodeAt(r++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}if(m(a.random(),o),t.exports){t.exports=h;try{s=n(12)}catch(t){}}else void 0===(i=function(){return h}.call(e,n,e,t))||(t.exports=i)}("undefined"!=typeof self?self:this,[],Math)},function(t,e){},function(t,e,n){"use strict";n.r(e),n.d(e,"VRMD",(function(){return o})),n.d(e,"seedrandom",(function(){return r.a}));n(4);var i=n(3),r=n.n(i);class o{constructor(){this.tree=null,this.cleanedMD=null}parse(t){console.log("parsing");let e={rooms:[],theme:{floor:null,walls:null,ceiling:null}},n={},i=[],r="",o="",a="",s="",l=!1,c=!1,u=t.split("\n");for(let t=0;t<u.length;t++){let h=u[t],d=h.split(" ");if("#"==d[0].charAt(0)&&!l){if(d[0].includes("###"))continue;r=d.shift(),null!=n.name?(n.text=o,n.artifacts=i,o="",i=[],"#"!=r&&"##"!=r||(e.rooms.push(n),n={})):""!=o&&(e.text=o,e.artifact=i,o="",i=[]),"#"==r&&(e.name=d.join(" ")),n.name=d.join(" ")}if(">"!=d[0].charAt(0)||l?""!=a&&(i.push(this.parseArtifact(a,"block quote")),a=""):a+=d.join(" ").replace(">","").replace(/(^[\s]+|[\s]+$)/,"\n"),d[0].includes("```")&&!l?(s+=h+"\n",l=!0):l?(h.includes("```")&&(l=!1),s+=h+"\n"):""==s&&"`"==d[0].charAt(0)?(s+=h+"\n",i.push(this.parseArtifact(s,"code")),s=""):l||""==s||(i.push(this.parseArtifact(s,"code block")),s=""),"!"!=d[0].charAt(0)||l||i.push(this.parseArtifact(h,"image")),"$"==d[0].charAt(0)&&!l){let n=h.substring(h.lastIndexOf("[")+1,h.lastIndexOf("]")),i=h.substring(h.lastIndexOf("(")+1,h.lastIndexOf(")"));switch(n){case"floor":e.theme.floor=i;break;case"walls":e.theme.walls=i;break;case"ceiling":e.theme.ceiling=i}u.splice(t,1),--t}"&"!=d[0].charAt(0)||l||(i.push(this.parseArtifact(h,"3D")),u.splice(t,1),--t),"^"!=d[0].charAt(0)||l||(this.addAudio(i,h),u.splice(t,1),--t),"~"!=d[0]||l||(c=!c),(c||"~"==d[0]&&!l)&&(u.splice(t,1),--t),o+=h+"\n"}return null!=n.name&&(n.text=o,n.artifacts=i,o="",i=[],e.rooms.push(n),n={}),this.tree=e,this.cleanedMD=u.join("\n"),this.tree}parseArtifact(t,e){let n={};switch(n.type=e,n.audioSrc=null,e){case"image":n.src=t.substring(t.lastIndexOf("(")+1,t.lastIndexOf(")")),n.alt=t.substring(t.lastIndexOf("[")+1,t.lastIndexOf("]"));break;case"block quote":n.text=t;break;case"code":n.code=t.replace(/`/g,"").replace("\n","");break;case"code block":let e=t.replace(/`/g,"");n.lang=e.split("\n")[0],n.code=e.replace(n.lang+"\n","");break;case"3D":n.src=t.substring(t.lastIndexOf("(")+1,t.lastIndexOf(")")),n.name=t.substring(t.lastIndexOf("[")+1,t.lastIndexOf("]"))}return n}addAudio(t,e){t[t.length-1].audioSrc=e.substring(e.lastIndexOf("(")+1,e.lastIndexOf(")"))}}}]);